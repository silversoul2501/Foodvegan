<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tu pedido</title>
<link rel="stylesheet" href="style.css">
<style>
.page{ max-width: 820px; margin: 24px auto; padding: 0 16px; }
.card{ background:#0f1a12; color:#e9f5ed; border-radius:14px; padding:14px; }
.row{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
.list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; }
.it{ background:#122017; border-radius:10px; padding:10px; display:grid; grid-template-columns:1fr auto; gap:6px; }
.controls button{ border:0; border-radius:8px; padding:6px 10px; cursor:pointer; }
.dec{ background:#26352c; color:#e9f5ed; } .inc{ background:#2e7d32; color:#fff; }
.del{ background:#6a2a2a; color:#fff; }
.tot{ display:flex; justify-content:space-between; margin-top:12px; font-weight:800; }
.actions{ display:flex; gap:10px; margin-top:12px; }
.btn{ background:#2e7d32; color:#fff; border:0; padding:10px 14px; border-radius:12px; font-weight:800; }
.sec{ background:#26352c; color:#e9f5ed; }
</style>
</head>
<body>
  <main class="page">
    <h2>Tu pedido</h2>
    <div class="card">
      <ul id="pList" class="list"></ul>
      <div class="tot"><span>Total</span><strong id="pTotal">$0</strong></div>
      <div class="actions">
        <button id="backBtn" class="btn sec">Seguir comprando</button>
        <button id="confirmBtn" class="btn">Confirmar compra</button>
      </div>
    </div>
  </main>

<script>
const MONEY = n => new Intl.NumberFormat('es-CL',{style:'currency',currency:'CLP',maximumFractionDigits:0}).format(n);
const CART_KEY = 'cartSimple';
const pList = document.getElementById('pList');
const pTotal = document.getElementById('pTotal');
const backBtn = document.getElementById('backBtn');
const confirmBtn = document.getElementById('confirmBtn');

let cart = [];
try{ cart = JSON.parse(localStorage.getItem(CART_KEY)) || []; }catch{ cart=[]; }

function total(){ return cart.reduce((s,p)=>s+p.price*p.qty,0); }
function save(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
function render(){
  if(!cart.length){ pList.innerHTML = '<li style="opacity:.8">No hay productos.</li>'; pTotal.textContent=MONEY(0); return; }
  pList.innerHTML = '';
  cart.forEach(i=>{
    const li = document.createElement('li');
    li.className='it'; li.dataset.id=i.id;
    li.innerHTML = `
      <div><div style="font-weight:700">${i.name}</div><div>${MONEY(i.price)} c/u</div></div>
      <div class="controls">
        <button class="dec">âˆ’</button>
        <span>${i.qty}</span>
        <button class="inc">ï¼‹</button>
        <button class="del">ðŸ—‘</button>
      </div>`;
    pList.appendChild(li);
  });
  pTotal.textContent = MONEY(total());
}
pList.addEventListener('click', e=>{
  const li=e.target.closest('.it'); if(!li) return;
  const id=li.dataset.id; const idx=cart.findIndex(x=>x.id===id); if(idx<0) return;
  if(e.target.classList.contains('inc')) cart[idx].qty++;
  if(e.target.classList.contains('dec')) { cart[idx].qty--; if(cart[idx].qty<=0) cart.splice(idx,1); }
  if(e.target.classList.contains('del')) cart.splice(idx,1);
  save(); render();
});
backBtn.addEventListener('click', ()=> window.location.href='home.html');
confirmBtn.addEventListener('click', ()=>{
  if(!cart.length){ alert('Tu carrito estÃ¡ vacÃ­o'); return; }
  const pedido = { items: cart, total: total(), ts: new Date().toISOString() };
  localStorage.setItem('pedidoConfirmado', JSON.stringify(pedido));
  cart=[]; save(); render();
  alert('âœ… Â¡Compra confirmada! Gracias por tu pedido.');
  window.location.href='home.html';
});
render();
</script>
</body>
</html>
